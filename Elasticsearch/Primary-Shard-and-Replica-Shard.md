### 들어가기 전에

Elasticsearch는 하나의 인덱스가 샤드라는 조각으로 나뉘고

각 샤드는 루씬 자체의 독립적인 인스턴스

컴퓨터에 클러스터가 있는 경우 샤드를 여러 컴퓨터에 분산 시키는 것이 가능


### Primary shard & Replica Shard

일반적으로 클러스터 내 물리적 서버 당 하나의 노드가 설치 됨

프라이머리 샤드 : 데이터의 원본
-> 쓰기 요청이 처음 보내질 곳

레플리카 샤드 : 데이터의 복제 
-> 읽기 요청을 처리할 수 있는 곳


### 왜 굳이 replica shard를 만드는가?

답은 복원력을 높이기 위해서

노드의 작동문제나 노드가 사라지게 된다면 다른 노드에 배치된 레플리카를 사용하도록 한다

레플리카를 프라이머리로 새롭게 지정 시 노드에 발생한 손실을 회복할 때까지 새로운 데이터를 받고 읽기 요청 가능


### shard 설정 예시

인덱스를 생성할 때 색인의 이름과 설정 구조, 프라이머리 샤드와 레플리카의 수를 나타내는 JSON을 지정해야 함


```
put /testindex      #요청  인덱스이름

{ 

“settings“: {

    “number_of_shards“:3     #프라이머리 샤드의 수

        “number_of_replicas“:1   #레플리카 샤드의 수

}
```

클러스터 내 프라이머리 샤드의 수를 설정 후에는 변경할 수 없음

-> 트래픽을 감당할 수 있는 충분한 프라이머리 샤드를 확보해놔야 함

예시의 총 샤드의 수는 4개가 아님

레플리카 샤드는 프라미어리 샤드의 수 당 1으로 보면 됨
